---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import BlogSearch from '../components/BlogSearch.astro';
import NewsletterSignup from '../components/NewsletterSignup.astro';
import { calculateReadingTime, formatDate } from '../utils/blog.js';

const posts = await getCollection('blog');
const baseUrl = import.meta.env.BASE_URL;
const sortedPosts = posts.sort((a, b) => new Date(b.data.pubDate).valueOf() - new Date(a.data.pubDate).valueOf());
---

<BaseLayout title="Blog - Dr. Sanjeeva Reddy Dodlapati">
  <main class="max-w-4xl mx-auto px-4 py-8">
    <header class="mb-12">
      <h1 class="text-4xl font-bold text-gray-900 mb-4">Blog</h1>
      <p class="text-xl text-gray-600 leading-relaxed mb-6">
        Insights, discoveries, and thoughts on AI, data science, and the intersection
        of technology with real-world applications. Updated weekly with new perspectives.
      </p>
      
      <!-- Search and RSS -->
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8">
        <div class="flex-1 max-w-md">
          <BlogSearch />
        </div>
        <div class="flex items-center space-x-4">
          <a 
            href={`${baseUrl}/rss.xml`}
            class="inline-flex items-center text-sm text-gray-600 hover:text-blue-600 transition-colors"
          >
            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
              <path d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z"/>
            </svg>
            RSS Feed
          </a>
        </div>
      </div>
    </header>

    {sortedPosts.length === 0 ? (
      <div class="text-center py-12">
        <div class="bg-white p-8 rounded-lg shadow-sm border border-gray-200">
          <h2 class="text-2xl font-semibold text-gray-900 mb-4">Coming Soon!</h2>
          <p class="text-gray-600 mb-6">
            I'm preparing thoughtful content about AI research, data science insights,
            and practical applications. Check back soon for regular updates.
          </p>
          <a 
            href={`${baseUrl}/contact`} 
            class="inline-block bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors"
          >
            Get Notified of New Posts
          </a>
        </div>
      </div>
    ) : (
      <section class="space-y-8">
        {sortedPosts.map((post) => {
          const formattedDate = formatDate(post.data.pubDate);
          const readingTime = calculateReadingTime(post.body);
          
          return (
            <article class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow">
              <header class="mb-4">
                <h2 class="text-2xl font-semibold text-gray-900 mb-2">
                  <a 
                    href={`${baseUrl}/blog/${post.id}`} 
                    class="hover:text-blue-600 transition-colors block py-1 px-2 -mx-2 rounded-md hover:bg-blue-50"
                  >
                    {post.data.title}
                  </a>
                </h2>
                <div class="flex items-center text-sm text-gray-500 space-x-4">
                  <time datetime={post.data.pubDate.toISOString()}>
                    {formattedDate}
                  </time>
                  <span>•</span>
                  <span>{post.data.author || 'Dr. Sanjeeva Reddy Dodlapati'}</span>
                  <span>•</span>
                  <span class="text-blue-600">{readingTime.readingTimeText}</span>
                  {post.data.tags && (
                    <>
                      <span>•</span>
                      <div class="flex space-x-2">
                        {post.data.tags.slice(0, 2).map((tag) => (
                          <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">
                            {tag}
                          </span>
                        ))}
                        {post.data.tags.length > 2 && (
                          <span class="text-gray-400 text-xs">+{post.data.tags.length - 2} more</span>
                        )}
                      </div>
                    </>
                  )}
                </div>
              </header>
              
              <div class="mb-4">
                <p class="text-gray-600 leading-relaxed">
                  {post.data.description || 'Click to read the full post and discover insights about AI, data science, and technology applications.'}
                </p>
              </div>
              
              <footer>
                <a 
                  href={`${baseUrl}/blog/${post.id}`} 
                  class="inline-flex items-center text-blue-600 hover:text-blue-700 font-medium transition-colors py-2 px-4 rounded-lg hover:bg-blue-50 border border-blue-200 hover:border-blue-300"
                >
                  Read More
                  <span class="ml-2">→</span>
                </a>
              </footer>
            </article>
          );
        })}
      </section>
    )}

    <aside class="mt-12 pt-8 border-t border-gray-200">
      <NewsletterSignup 
        title="Stay Updated with AI Research Insights"
        description="Get notified when I publish new insights about AI research, data science applications, and technology trends. No spam, just valuable content delivered to your inbox."
        placement="inline"
        theme="light"
      />
    </aside>
  </main>
</BaseLayout>

<style>
  article:hover {
    transform: translateY(-2px);
  }
</style>