---
// Advanced Academic Analytics Dashboard - Research-focused metrics
interface Props {
  showResearchMetrics?: boolean;
  showPublicationMetrics?: boolean;
  showCollaborationMetrics?: boolean;
  className?: string;
}

const { 
  showResearchMetrics = true,
  showPublicationMetrics = true, 
  showCollaborationMetrics = true,
  className = ''
} = Astro.props;
---

<div class={`academic-analytics-dashboard ${className}`}>
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <div class="header-info">
      <h2 class="dashboard-title">Academic Analytics Dashboard</h2>
      <p class="dashboard-subtitle">Real-time insights into research impact and engagement</p>
    </div>
    
    <div class="dashboard-controls">
      <button class="control-btn" id="refresh-data" title="Refresh analytics data">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
        </svg>
      </button>
      
      <button class="control-btn" id="export-data" title="Export analytics data">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
      </button>
      
      <div class="time-range-selector">
        <select id="time-range" class="time-select">
          <option value="7d">Last 7 days</option>
          <option value="30d" selected>Last 30 days</option>
          <option value="90d">Last 3 months</option>
          <option value="1y">Last year</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Key Performance Indicators -->
  <div class="kpi-grid">
    <div class="kpi-card primary">
      <div class="kpi-header">
        <h3>Total Citations</h3>
        <svg class="kpi-icon" fill="currentColor" viewBox="0 0 24 24">
          <path d="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z"/>
        </svg>
      </div>
      <div class="kpi-value">
        <span id="total-citations">--</span>
        <div class="kpi-change positive">
          <svg class="change-icon" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
          </svg>
          <span id="citations-change">+12%</span>
        </div>
      </div>
    </div>

    <div class="kpi-card secondary">
      <div class="kpi-header">
        <h3>H-Index Impact</h3>
        <svg class="kpi-icon" fill="currentColor" viewBox="0 0 24 24">
          <path d="M16,6L18.29,8.29L13.41,13.17L9.41,9.17L2,16.59L3.41,18L9.41,12L13.41,16L19.71,9.71L22,12V6H16Z"/>
        </svg>
      </div>
      <div class="kpi-value">
        <span id="h-index">--</span>
        <div class="kpi-change positive">
          <svg class="change-icon" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
          </svg>
          <span id="hindex-change">+2</span>
        </div>
      </div>
    </div>

    <div class="kpi-card tertiary">
      <div class="kpi-header">
        <h3>Research Views</h3>
        <svg class="kpi-icon" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"/>
        </svg>
      </div>
      <div class="kpi-value">
        <span id="research-views">--</span>
        <div class="kpi-change positive">
          <svg class="change-icon" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
          </svg>
          <span id="views-change">+24%</span>
        </div>
      </div>
    </div>

    <div class="kpi-card quaternary">
      <div class="kpi-header">
        <h3>Collaboration Index</h3>
        <svg class="kpi-icon" fill="currentColor" viewBox="0 0 24 24">
          <path d="M16,4C18.21,4 20,5.79 20,8C20,10.21 18.21,12 16,12C13.79,12 12,10.21 12,8C12,5.79 13.79,4 16,4M16,13.54C18.81,13.54 22,14.23 22,16.18V18H10V16.18C10,14.23 13.19,13.54 16,13.54M8,12C10.21,12 12,10.21 12,8C12,5.79 10.21,4 8,4C5.79,4 4,5.79 4,8C4,10.21 5.79,12 8,12M8,13.54C5.19,13.54 2,14.23 2,16.18V18H9V16.18C9,15.14 9.5,14.35 10.24,13.78C9.55,13.61 8.81,13.54 8,13.54Z"/>
        </svg>
      </div>
      <div class="kpi-value">
        <span id="collaboration-index">--</span>
        <div class="kpi-change neutral">
          <svg class="change-icon" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
          </svg>
          <span id="collab-change">0%</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Research Metrics Section -->
  {showResearchMetrics && (
    <div class="metrics-section">
      <h3 class="section-title">Research Impact Metrics</h3>
      <div class="metrics-grid">
        <div class="metric-card chart-card">
          <div class="card-header">
            <h4>Citation Trends</h4>
            <div class="chart-controls">
              <button class="chart-btn active" data-chart="citations-monthly">Monthly</button>
              <button class="chart-btn" data-chart="citations-yearly">Yearly</button>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="citations-chart" width="400" height="200"></canvas>
          </div>
        </div>

        <div class="metric-card">
          <div class="card-header">
            <h4>Top Cited Publications</h4>
          </div>
          <div class="publication-list">
            <div class="publication-item">
              <div class="pub-info">
                <h5 class="pub-title">AI Applications in Genomic Analysis</h5>
                <p class="pub-venue">Nature Biotechnology, 2024</p>
              </div>
              <div class="pub-metrics">
                <span class="citation-count">142 citations</span>
                <div class="impact-bar">
                  <div class="impact-fill" style="width: 85%"></div>
                </div>
              </div>
            </div>
            
            <div class="publication-item">
              <div class="pub-info">
                <h5 class="pub-title">Machine Learning in Bioinformatics</h5>
                <p class="pub-venue">Cell, 2023</p>
              </div>
              <div class="pub-metrics">
                <span class="citation-count">98 citations</span>
                <div class="impact-bar">
                  <div class="impact-fill" style="width: 60%"></div>
                </div>
              </div>
            </div>
            
            <div class="publication-item">
              <div class="pub-info">
                <h5 class="pub-title">Computational Biology Methods</h5>
                <p class="pub-venue">Science, 2023</p>
              </div>
              <div class="pub-metrics">
                <span class="citation-count">76 citations</span>
                <div class="impact-bar">
                  <div class="impact-fill" style="width: 45%"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  )}

  <!-- Publication Metrics Section -->
  {showPublicationMetrics && (
    <div class="metrics-section">
      <h3 class="section-title">Publication Analytics</h3>
      <div class="metrics-grid">
        <div class="metric-card chart-card">
          <div class="card-header">
            <h4>Publication Timeline</h4>
          </div>
          <div class="chart-container">
            <canvas id="publications-timeline" width="400" height="200"></canvas>
          </div>
        </div>

        <div class="metric-card">
          <div class="card-header">
            <h4>Journal Impact Distribution</h4>
          </div>
          <div class="impact-distribution">
            <div class="impact-category">
              <div class="category-header">
                <span class="category-name">High Impact (IF > 10)</span>
                <span class="category-count">8 publications</span>
              </div>
              <div class="category-bar">
                <div class="category-fill high-impact" style="width: 40%"></div>
              </div>
            </div>
            
            <div class="impact-category">
              <div class="category-header">
                <span class="category-name">Medium Impact (IF 5-10)</span>
                <span class="category-count">12 publications</span>
              </div>
              <div class="category-bar">
                <div class="category-fill medium-impact" style="width: 60%"></div>
              </div>
            </div>
            
            <div class="impact-category">
              <div class="category-header">
                <span class="category-name">Standard Impact (IF < 5)</span>
                <span class="category-count">5 publications</span>
              </div>
              <div class="category-bar">
                <div class="category-fill standard-impact" style="width: 25%"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  )}

  <!-- Collaboration Metrics Section -->
  {showCollaborationMetrics && (
    <div class="metrics-section">
      <h3 class="section-title">Collaboration Network</h3>
      <div class="metrics-grid">
        <div class="metric-card chart-card">
          <div class="card-header">
            <h4>Collaboration Map</h4>
          </div>
          <div class="collaboration-map">
            <div class="map-placeholder">
              <p>Interactive collaboration network visualization</p>
              <button class="map-btn">Load Network Graph</button>
            </div>
          </div>
        </div>

        <div class="metric-card">
          <div class="card-header">
            <h4>Top Collaborators</h4>
          </div>
          <div class="collaborator-list">
            <div class="collaborator-item">
              <div class="collaborator-avatar">
                <span class="avatar-initial">JS</span>
              </div>
              <div class="collaborator-info">
                <h5 class="collaborator-name">Dr. Jane Smith</h5>
                <p class="collaborator-affiliation">Stanford University</p>
              </div>
              <div class="collaboration-stats">
                <span class="collab-count">12 papers</span>
                <span class="collab-citations">340 citations</span>
              </div>
            </div>
            
            <div class="collaborator-item">
              <div class="collaborator-avatar">
                <span class="avatar-initial">MJ</span>
              </div>
              <div class="collaborator-info">
                <h5 class="collaborator-name">Prof. Michael Johnson</h5>
                <p class="collaborator-affiliation">MIT</p>
              </div>
              <div class="collaboration-stats">
                <span class="collab-count">8 papers</span>
                <span class="collab-citations">225 citations</span>
              </div>
            </div>
            
            <div class="collaborator-item">
              <div class="collaborator-avatar">
                <span class="avatar-initial">LW</span>
              </div>
              <div class="collaborator-info">
                <h5 class="collaborator-name">Dr. Lisa Wang</h5>
                <p class="collaborator-affiliation">Harvard Medical School</p>
              </div>
              <div class="collaboration-stats">
                <span class="collab-count">6 papers</span>
                <span class="collab-citations">180 citations</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  )}

  <!-- Real-time Updates Footer -->
  <div class="dashboard-footer">
    <div class="update-info">
      <span class="update-indicator"></span>
      <span class="update-text">Last updated: <span id="last-update">--</span></span>
    </div>
    
    <div class="data-sources">
      <span class="sources-label">Data sources:</span>
      <div class="source-badges">
        <span class="source-badge">Google Scholar</span>
        <span class="source-badge">PubMed</span>
        <span class="source-badge">ResearchGate</span>
        <span class="source-badge">ORCID</span>
      </div>
    </div>
  </div>
</div>

<style>
  .academic-analytics-dashboard {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    border: 1px solid #e2e8f0;
    border-radius: 16px;
    padding: 32px;
    margin: 32px 0;
    font-family: 'Inter', system-ui, sans-serif;
  }
  
  .dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 32px;
    flex-wrap: wrap;
    gap: 16px;
  }
  
  .header-info {
    flex: 1;
    min-width: 300px;
  }
  
  .dashboard-title {
    font-size: 28px;
    font-weight: 700;
    color: #1e293b;
    margin: 0 0 8px 0;
  }
  
  .dashboard-subtitle {
    font-size: 16px;
    color: #64748b;
    margin: 0;
  }
  
  .dashboard-controls {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
  }
  
  .control-btn {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 8px;
    color: #64748b;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .control-btn:hover {
    border-color: #3b82f6;
    color: #3b82f6;
    box-shadow: 0 2px 4px rgba(59, 130, 246, 0.1);
  }
  
  .time-select {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 8px 12px;
    color: #374151;
    font-size: 14px;
    cursor: pointer;
  }
  
  .kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
  }
  
  .kpi-card {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 24px;
    transition: all 0.2s ease;
    position: relative;
    overflow: hidden;
  }
  
  .kpi-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
  }
  
  .kpi-card.primary::before {
    background: linear-gradient(90deg, #3b82f6, #1d4ed8);
  }
  
  .kpi-card.secondary::before {
    background: linear-gradient(90deg, #10b981, #047857);
  }
  
  .kpi-card.tertiary::before {
    background: linear-gradient(90deg, #f59e0b, #d97706);
  }
  
  .kpi-card.quaternary::before {
    background: linear-gradient(90deg, #8b5cf6, #7c3aed);
  }
  
  .kpi-card:hover {
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
    transform: translateY(-2px);
  }
  
  .kpi-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
  }
  
  .kpi-header h3 {
    font-size: 14px;
    font-weight: 500;
    color: #64748b;
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  
  .kpi-icon {
    width: 20px;
    height: 20px;
    color: #94a3b8;
  }
  
  .kpi-value {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
  }
  
  .kpi-value > span {
    font-size: 32px;
    font-weight: 700;
    color: #1e293b;
  }
  
  .kpi-change {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 14px;
    font-weight: 600;
  }
  
  .kpi-change.positive {
    color: #10b981;
  }
  
  .kpi-change.negative {
    color: #ef4444;
  }
  
  .kpi-change.neutral {
    color: #64748b;
  }
  
  .change-icon {
    width: 16px;
    height: 16px;
  }
  
  .metrics-section {
    margin-bottom: 40px;
  }
  
  .section-title {
    font-size: 20px;
    font-weight: 600;
    color: #1e293b;
    margin: 0 0 20px 0;
    padding-bottom: 8px;
    border-bottom: 2px solid #e2e8f0;
  }
  
  .metrics-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 20px;
  }
  
  .metric-card {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 24px;
  }
  
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }
  
  .card-header h4 {
    font-size: 16px;
    font-weight: 600;
    color: #1e293b;
    margin: 0;
  }
  
  .chart-controls {
    display: flex;
    gap: 8px;
  }
  
  .chart-btn {
    background: none;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    padding: 4px 12px;
    font-size: 12px;
    font-weight: 500;
    color: #64748b;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .chart-btn.active,
  .chart-btn:hover {
    background: #3b82f6;
    border-color: #3b82f6;
    color: white;
  }
  
  .chart-container {
    width: 100%;
    height: 200px;
    position: relative;
  }
  
  .publication-list,
  .collaborator-list {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  
  .publication-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    background: #f8fafc;
    border-radius: 8px;
  }
  
  .pub-info {
    flex: 1;
  }
  
  .pub-title {
    font-size: 14px;
    font-weight: 600;
    color: #1e293b;
    margin: 0 0 4px 0;
    line-height: 1.4;
  }
  
  .pub-venue {
    font-size: 12px;
    color: #64748b;
    margin: 0;
    font-style: italic;
  }
  
  .pub-metrics {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 4px;
  }
  
  .citation-count {
    font-size: 12px;
    font-weight: 600;
    color: #3b82f6;
  }
  
  .impact-bar {
    width: 60px;
    height: 4px;
    background: #e2e8f0;
    border-radius: 2px;
    overflow: hidden;
  }
  
  .impact-fill {
    height: 100%;
    background: linear-gradient(90deg, #3b82f6, #1d4ed8);
    border-radius: 2px;
  }
  
  .impact-distribution {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  
  .impact-category {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  
  .category-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .category-name {
    font-size: 14px;
    font-weight: 500;
    color: #374151;
  }
  
  .category-count {
    font-size: 12px;
    color: #64748b;
  }
  
  .category-bar {
    width: 100%;
    height: 8px;
    background: #f1f5f9;
    border-radius: 4px;
    overflow: hidden;
  }
  
  .category-fill {
    height: 100%;
    border-radius: 4px;
  }
  
  .high-impact {
    background: linear-gradient(90deg, #10b981, #047857);
  }
  
  .medium-impact {
    background: linear-gradient(90deg, #f59e0b, #d97706);
  }
  
  .standard-impact {
    background: linear-gradient(90deg, #6b7280, #4b5563);
  }
  
  .collaboration-map {
    height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .map-placeholder {
    text-align: center;
    color: #64748b;
  }
  
  .map-btn {
    background: #3b82f6;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 8px 16px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    margin-top: 12px;
    transition: background 0.2s ease;
  }
  
  .map-btn:hover {
    background: #2563eb;
  }
  
  .collaborator-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: #f8fafc;
    border-radius: 8px;
  }
  
  .collaborator-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #3b82f6;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }
  
  .avatar-initial {
    color: white;
    font-weight: 600;
    font-size: 14px;
  }
  
  .collaborator-info {
    flex: 1;
  }
  
  .collaborator-name {
    font-size: 14px;
    font-weight: 600;
    color: #1e293b;
    margin: 0 0 2px 0;
  }
  
  .collaborator-affiliation {
    font-size: 12px;
    color: #64748b;
    margin: 0;
  }
  
  .collaboration-stats {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 2px;
  }
  
  .collab-count,
  .collab-citations {
    font-size: 11px;
    color: #64748b;
  }
  
  .collab-count {
    font-weight: 600;
    color: #3b82f6;
  }
  
  .dashboard-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 24px;
    border-top: 1px solid #e2e8f0;
    flex-wrap: wrap;
    gap: 16px;
  }
  
  .update-info {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    color: #64748b;
  }
  
  .update-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #10b981;
    animation: pulse 2s infinite;
  }
  
  .data-sources {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
  }
  
  .sources-label {
    font-size: 12px;
    color: #64748b;
    font-weight: 500;
  }
  
  .source-badges {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
  }
  
  .source-badge {
    background: #e0e7ff;
    color: #3730a3;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 500;
  }
  
  @keyframes pulse {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: 0.5;
    }
  }
  
  /* Mobile responsive */
  @media (max-width: 1024px) {
    .metrics-grid {
      grid-template-columns: 1fr;
    }
  }
  
  @media (max-width: 768px) {
    .academic-analytics-dashboard {
      padding: 20px;
    }
    
    .dashboard-header {
      flex-direction: column;
      align-items: stretch;
    }
    
    .dashboard-controls {
      justify-content: center;
    }
    
    .kpi-grid {
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }
    
    .dashboard-footer {
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
  }
</style>

<script>
class AcademicAnalytics {
  constructor() {
    this.initializeCharts();
    this.loadAnalyticsData();
    this.setupEventListeners();
    this.startRealTimeUpdates();
  }
  
  initializeCharts() {
    // Initialize Chart.js charts for academic metrics
    // This would integrate with actual academic databases
    console.log('Academic Analytics Dashboard initialized');
  }
  
  loadAnalyticsData() {
    // Simulate loading real academic data
    this.updateKPIs();
    this.updateLastUpdateTime();
  }
  
  updateKPIs() {
    // Update KPI values with academic metrics
    const citations = document.getElementById('total-citations');
    const hIndex = document.getElementById('h-index');
    const views = document.getElementById('research-views');
    const collabIndex = document.getElementById('collaboration-index');
    
    if (citations) citations.textContent = '1,247';
    if (hIndex) hIndex.textContent = '28';
    if (views) views.textContent = '15.2K';
    if (collabIndex) collabIndex.textContent = '0.74';
  }
  
  updateLastUpdateTime() {
    const updateElement = document.getElementById('last-update');
    if (updateElement) {
      updateElement.textContent = new Date().toLocaleString();
    }
  }
  
  setupEventListeners() {
    // Refresh data button
    const refreshBtn = document.getElementById('refresh-data');
    if (refreshBtn) {
      refreshBtn.addEventListener('click', () => {
        this.loadAnalyticsData();
      });
    }
    
    // Export data button
    const exportBtn = document.getElementById('export-data');
    if (exportBtn) {
      exportBtn.addEventListener('click', () => {
        this.exportData();
      });
    }
    
    // Time range selector
    const timeSelect = document.getElementById('time-range');
    if (timeSelect) {
      timeSelect.addEventListener('change', (e) => {
        this.updateTimeRange(e.target.value);
      });
    }
  }
  
  exportData() {
    // Export analytics data to CSV
    const data = {
      timestamp: new Date().toISOString(),
      totalCitations: 1247,
      hIndex: 28,
      researchViews: 15200,
      collaborationIndex: 0.74
    };
    
    const csvContent = Object.entries(data)
      .map(([key, value]) => `${key},${value}`)
      .join('\n');
    
    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'academic-analytics.csv';
    a.click();
    window.URL.revokeObjectURL(url);
  }
  
  updateTimeRange(range) {
    console.log(`Updating analytics for time range: ${range}`);
    // Update charts and metrics based on time range
    this.loadAnalyticsData();
  }
  
  startRealTimeUpdates() {
    // Update metrics every 5 minutes
    setInterval(() => {
      this.updateLastUpdateTime();
      // In a real implementation, this would fetch fresh data
    }, 300000);
  }
}

// Initialize academic analytics
document.addEventListener('DOMContentLoaded', () => {
  new AcademicAnalytics();
});
</script>